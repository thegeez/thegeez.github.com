<h1 id="post-title">Serverless Clojure web app on AWS Lambda</h1>

<p>The <a href="https://postings.thegeez.net">Postings</a> app is a simple
 web application for posting text and comments. It is very old
 fashioned because it serves html pages from a server, instead of being a big
 ClojureScript or JavaScript application with Reagent or React. The
 web app does use a tiny bit of JavaScript to load certain html pages
 inline, following the ideas of <a href="https://github.com/turbolinks/turbolinks">turbolinks</a>. To post a comment
 the server sends a page with a comment form in it and renders the
 form inline for a nice user experience. Therefore there is no client side
 state to manage for a nice developer experience, both of which are me.

<br><br>INDEX PIC

<br><br>PAGE WITH COMMENT FORM OPEN<br><br>

Each post has a history page with all the edits made to it. There's
also a search box to search all the posts and comments. To try it out
you can use a simple guest account: <a href="https://postings.thegeez.net/login">login to Postings</a>
</p>

<p>
The goal of this project for me was to build something serverless on
Amazon Web Services (<a href="https://aws.amazon.com">AWS</a>) and
using <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a> So the
Arch
dynamo
web server
two stream readers for history entries and elastic search indexing
Eventual consistent, but actions for posting and commenting are
consistent. A user will always see the result of its action, but
seeing your post arrive on the index page take a small amount of time.
</p>

<p>
Libs
Reitit, nicer pedestal, route tree without pedestal quircks

AWS-api combine with core async reitit, rebl

Selmer templating, simple html
</p>

<p>
Deploy

java uberjars, good response time, 11 second warm up

Deploy uberjars on ec2 for webserver
Ran out of free tier for ec2 a long time ago

Serverless on lambda with api gateway HTTP api. No VPC set-up
required.
</p>

Graalvm + native image
clj-http-lite instead of cognitect.http-client

14GB memory usage for building
20 minute build time for snappy start up time (still sometimes a
noticable second, but liveable and improvable by running with more
memory and cpu)

clojure great at req->response as Rich has said (linke dat ions ~37
min mark)


feels like clojurescript advanced compile. In that sense it would also
make sense to not use core.async and threadpooling things
Write java for short running single threaded execution instead of long
running multi threaded execution. 

Keeping dynamic during development, fast and nimble for deploy

<p>BLABALABLABALBPreviously I've worked on a collaborative tool, which worked like Google Docs. This project was
  called <a href="/2017/02/11/crepl_atom_sync.html">crepl</a>. Because
  I stopped paying for hosting of its server, that project is now
  offline. That made me consider: what if a collaborative editor wouldn't need a
  server?</p>
